*** TODO: I am being very inconsistent about frontend, backend, worker,
*** worker... If I am to expect anyone to be able to follow along I'm going
*** to have to come up with a consistent dictionary. 
***
*** Dictionary started, will remove this note when I'm done converting
*** all existing documentation to the terminology.

While writing documentation to build against I'll have ideas for things that
should be documented better later. That's what this file is for.

[ PROTOCOL ]
CONNECT: When intiating a new connection to a broker a worker must validate 
             it's config.
    Parameters:
        config_type:     
            The format the worker accepts the config in. Can be JSON, XML
            or ZFL.

If the application already has a config, it will also pass a configversion
option.

CONFIG - Broker reply with configuration.
    Parameters:
        config_type:
            The format the config is in.
        config:
            The config.

NEEDBROKER - In the event that a worker is unable to connect to it's prefered
broker, it may try to connect to another one with a NEEDBROKER request. This
will include the worker identity and services offered. 

*** The broker group will then need to determine if thers is a problem, or
route the worker to a new broker, setting it as it's preferred broker. If
there is an issue with a broker and it's restarted maybe it should connect
the worker to tell it to switch back? ****


PING: This is the standard heartbeat request. When a Broker receives a PING
    from a Worker it will add it to the LRU queue if it's not already in it.
    Parameters:
        heartbeat_interval:
            The interval at which the broker can expect heartbeat requests
            from the worker. 

        time:
            Time according to worker when heartbeat request was sent.
            If this is way off from the time on the server, then there
            is a problem and an error will be returned while the worker
            will be disconnected.

        config_version: 
            Configuration version. Heavy to include, but will help ensure
            workers are running against the current configuration.

PONG: This is the response to PING
    Parameters:
        time:
            Time according to worker when heartbeat request was sent.
            If this is way off from the time on the server, then there
            is a problem and an error will be returned while the worker
            will be disconnected.

        config_version: 
            Configuration version. Heavy to include, but will help ensure
            workers are running against the current configuration.

WORKREQUEST: This is the request asking a worker to do some work. This
    will remove the worker from the LRU queue and add it to the wait queue.

    *** Need to plug in how wait queue will work. Maybe this is a good time
    *** to think about implementing the binary star pattern as an option.
    *** Optionally brokers could have fallbacks. I think this should be
    *** hard configured with each broker, that broker responsible for keeping
    *** it's fallback server up to date. Meaning the fallback broker won't
    *** subscribe to group ports unless it's activated.


    Parameters:

        time:
            Time according to worker when heartbeat request was sent.
            If this is way off from the time on the server, then there
            is a problem and an error will be returned while the worker
            will be disconnected.

        config_version: 
            Configuration version. Heavy to include, but will help ensure
            workers are running against the current configuration.

        work_request_indentifier: This will be the identity of the frontend
            that made the request and the message id, used for routing.

        body: The body of the request. This is service dependent, Scale0 does
            not have interest in the data herein.

WORKREPLY: This is the reply to a work request. The broker won't care about any
    errors about the work request, it will be up to the frontend to manage that.

DISCONNECTERROR:
    Returned to workers when they are disconnected for an error. Properties
    are
        Error Code: *** thinking I should see if standard http error codes
                    will be a good fit. ***

        Error Message: Pretty error message to send to worker.

FORCENEGOTIATE:
    Sent by broker to worker in the event the broker isn't sure if the worker
    is in an acceptable state. Upon getting this message from a broker a worker
    should initiate CONNECT.

[ CONNECTIONS ]

Examples of connections to wrap my head around how they work.
C = worker
B = broker

 - worker startup, broker down:
* worker must be informed of a broker to connect to. If it's saving it's config
* locally it may remember, and also have the group information to fallback on
* to find a new broker. This will be encouraged for workers, but not required.

C --- CONNECT ---> B
No response from B, worker fails to start with error.

 - worker startup, broker up
* worker must be informed of a broker to connect to. If it's saving it's config
* locally it may remember, and also have the group information to fallback on
* to find a new broker. This will be encouraged for workers, but not required.
C ------CONNECT ----> B
C <---- CONFIG ------ B
C ----- PING -------> B
C <---- PONG -------- B
 
* It's at this point that the broker registers the worker in the LRU queue.

